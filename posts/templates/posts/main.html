{% extends 'posts/base.html' %} {% block content %}
{% load static %}
<div class="content">
  <div id="main__main_div">
    <form method="GET">
      <div id="main__search_div">
        <div id="main__search_div__top">
          <div id="search_div__top_left">
            <div id="search_div__top_left__nav">
              <span><a href="{% url 'posts:home' 'all' %}">ì „ì²´</a></span>
              <span><a href="{% url 'posts:home' 'offline' %}">ì˜¤í”„ë¼ì¸</a></span>
              <span><a href="{% url 'posts:home' 'online' %}">ì˜¨ë¼ì¸</a></span>
              <span><a href="{% url 'posts:home' 'mix' %}">í˜¼í•©</a></span>
            </div>
            <div id="search_div__top_left__search">
              {% if search %}
              <i class="fa-solid fa-magnifying-glass"></i>
              <input
                id="main__search_text"
                type="text"
                name="search"
                placeholder="ê´€ì‹¬ ëª¨ê°ì½”ë¥¼ ê²€ìƒ‰í•˜ì„¸ìš”"
                value="{{ search }}"
              />
              {% else %}
              <i class="fa-solid fa-magnifying-glass"></i>
              <input type="text" name="search" class="main__search_text" placeholder="ê´€ì‹¬ ëª¨ê°ì½”ë¥¼ ê²€ìƒ‰í•´ë³´ì„¸ìš”">
              {% endif %}
              <input
                id="main__search_tag"
                type="text"
                placeholder="íƒœê·¸ë¡œ ê²€ìƒ‰í•´ë³´ì„¸ìš”"
                name="tag"
              />
            </div>
          </div>
          <div id="search_div__top_right">
            <div id="search_div__top_right__switch">
              <div class="search_div__top_right__switch_txt">
                <p>ëª¨ì§‘ì¤‘ë§Œ ë³´ê¸°</p>
              </div>
              <div class="wrapper">
                <input type="checkbox" id="switch" name="onActive" onchange="this.form.submit();" {% if onActive == "on" %}checked{%endif%}/>
                <label for="switch" class="switch_label">
                  <span class="onf_btn"></span>
                </label>
              </div>
            </div>
            <div id="search_div__top_right__btn">
              <button id="main__search_btn" type="submit">ê²€ìƒ‰</button>
            </div>
            <div id="search_div__top_right__reset">
              <div class="post_main__tag__reset">
                <i class="fa-solid fa-arrows-rotate" style="color: black;"></i>
                <input type="reset" name="reset" class="post-main__tag__reset" value="ì´ˆê¸°í™”" onClick="location.href='/post'">
              </div>
            </div>
          </div>
        </div>
        <div id="main__search_div__tag">
          <ul class="main__search_li__tag_flex">
            {% for stag in tag_for_show %}
            <li>{{stag}}</li>
            {%endfor%} 
          </ul>
        </div>
        <div id="main__info_div__top">
          <select id="sort" name="sort" onchange="this.form.submit();">
            <option value="default">--ì •ë ¬ê¸°ì¤€--</option>
            <option value="latest" {% if sort == "latest" %}selected{% endif %}>ìµœì‹ ìˆœ</option>
            <option value="views" {% if sort == "views" %}selected{% endif %}>ì¡°íšŒìˆœ</option>
            <option value="comments" {% if sort == "comments" %}selected{% endif %}>ëŒ“ê¸€ìˆœ</option>
            <option value="likes" {% if sort == "likes" %}selected{% endif %}>ì¢‹ì•„ìš”ìˆœ</option>
          </select>
          <div id="main__info_div__box">
            <select name="duration" class="selectbox" onchange="this.form.submit();">
              <option value="all" class="lang-option">ì „ì²´</option>
              <option value="Regular" class="lang-option" {% if duration == "Regular" %}selected{% endif %}>ğŸ“… ì •ê¸°</option>
              <option value="OneTime" class="lang-option" {% if duration == "OneTime" %}selected{% endif %}>âš¡ï¸ ë²ˆê°œ</option>
            </select>
          </div>
        </div>
      </div>
    </form>
    <div id="main__info_div">
      {% for post in posts %}
      <div id="main__info_div__post" onclick="location.href='{% url 'posts:detail' post.id %}';">
        <div id="main__info_div__post_left">
          <div id="main__info_div__post_left__tag">
            <ul class="main__info_li__tag_flex">
              {% if post.activation %}
              <li id="main__top_left__ul__recruit">ëª¨ì§‘ì¤‘</li>
              {% else %}
              <li id="main__top_left__ul__recruit_finish">ëª¨ì§‘ì™„ë£Œ</li>
              {% endif %}
              {% for key, value in tags.items %}
              {% if key == post.id %}
              {% for v in value %}
              <li>{{v}}</li>
              {% endfor %}
              {% endif %}
              {% endfor %}  
            </ul>
          </div>
          <div id="main__info_div__post_left__title">
            {{post.title}}
          </div>
          <div id="main__info_div__post_left__content">
            {{post.content|truncatechars:142|safe}}
          </div>
          <div id="main__info_div__post_left__reaction">
            <i class="fa-solid fa-eye"></i>
            <span>{{post.views}}</span>
            <i class="fa-solid fa-comment-dots"></i>
            <span>{{post.comment_set.all|length}}</span>
            {% if post.user in post.like_users.all %}
              <i id="blank" class="fa-solid fa-heart"></i> <!-- ì±„ì›Œì ¸ ìˆëŠ” í•˜íŠ¸-->
              <span id="like_count">{{post.likes}}</span>
              {% else %}
              <i id="blank" class="fa-regular fa-heart"></i> <!--ë¹„ì–´ìˆëŠ” í•˜íŠ¸-->
              <span id="like_count">{{post.likes}}</span>
              {% endif %}
          </div>
        </div>
        <div id="main__info_div__post_right">
          <div id="main__info_div__post_right__img">
            <span class="content-title__img">
              {% if post.user.profile_img %}
              <div class="profile_img"><img src="{{post.user.profile_img.url}}" alt="profile_img"></img></div>
              {% else %}
              <div class="profile_img"><img src="{% static "img/moco_symbol.png" %}" alt="profile_img"></img></div>
              {% endif %}
            </span>
          </div>
          <div id="main__info_div__post_right__info">
            <div id="main__info_div__post_right__info_name">
              <span>{{post.user.nickname}}</span>
            </div>
            <div id="main__info_div__post_right__info_time">
              <span>{{post.published_at|date:"Y-m-d"}}</span>
            </div>
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
  </div>
  <script src="/static/js/post_main.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
	<script>
		let inputElm = document.querySelector('input[id=main__search_tag]');

		// initialize Tagify
		var tagify = new Tagify(inputElm);
		tagify
			.on('add', onAddTag) // íƒœê·¸ê°€ ì¶”ê°€ë˜ë©´
			.on('remove', onRemoveTag) // íƒœê·¸ê°€ ì œê±°ë˜ë©´
			.on('input', onInput) // íƒœê·¸ê°€ ì…ë ¥ë˜ê³  ìˆì„ ê²½ìš°
			.on('invalid', onInvalidTag) // í—ˆìš©ë˜ì§€ ì•ŠëŠ” íƒœê·¸ì¼ ê²½ìš°
			.on('click', onTagClick) // í•´ì‹œ íƒœê·¸ ë¸”ëŸ­ì„ í´ë¦­í•  ê²½ìš°
			.on('focus', onTagifyFocusBlur) // í¬ì»¤ìŠ¤ ë  ê²½ìš°
			.on('blur', onTagifyFocusBlur) // ë°˜ëŒ€ë¡œ í¬ì»¤ìŠ¤ë¥¼ ìƒì„ ê²½ìš°

			.on('edit:start', onTagEdit) // ì…ë ¥ëœ íƒœê·¸ ìˆ˜ì •ì„ í•  ê²½ìš°

			.on('dropdown:hide dropdown:show', (e) => console.log(e.type)) // ë“œë¡­ë‹¤ìš´ ë©”ë‰´ê°€ ì‚¬ë¼ì§ˆê²½ìš°
			.on('dropdown:select', onDropdownSelect); // ë“œë¡­ë‹¤ìš´ ë©”ë‰´ì—ì„œ ì•„ì´í…œì„ ì„ íƒí•  ê²½ìš°

		// tagify ì „ìš© ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì œê±° í• ë–„
		tagify.off('add', onAddTag);

		// ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì½œë°± ë©”ì†Œë“œ
		function onAddTag(e) {
			console.log('onAddTag: ', e.detail);
			console.log('original input value: ', inputElm.value);
		}

		// tag remvoed callback
		function onRemoveTag(e) {
			console.log('onRemoveTag:', e.detail, 'tagify instance value:', tagify.value);
		}

		function onTagEdit(e) {
			console.log('onTagEdit: ', e.detail);
		}

		// invalid tag added callback
		function onInvalidTag(e) {
			console.log('onInvalidTag: ', e.detail);
		}

		// invalid tag added callback
		function onTagClick(e) {
			console.log(e.detail);
			console.log('onTagClick: ', e.detail);
		}

		function onTagifyFocusBlur(e) {
			console.log(e.type, 'event fired');
		}

		function onDropdownSelect(e) {
			console.log('onDropdownSelect: ', e.detail);
		}

		function onInput(e) {
			console.log('onInput: ', e.detail);

			tagify.loading(true); // íƒœê·¸ ì…ë ¥í•˜ëŠ”ë° ìš°ì¸¡ì— loader ì• ë‹ˆë©”ì´ì…˜ ì¶”ê°€
			tagify.loading(false); // loader ì• ë‹ˆë©”ì´ì…˜ ì œê±°

			tagify.dropdown.show(e.detail.value); // ë“œë¡­ë‹¤ìš´ ë©”ë‰´ ë³´ì—¬ì£¼ê¸°
			tagify.dropdown.hide(); // // ë“œë¡­ë‹¤ìš´ ì œê±°
		}

    </script>

</div>
{% endblock content %}
